<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>le-petit-prince-v2</title>
    <meta name="description" content="le-petit-prince-v2" />

    <script src="/script.js" defer></script>
    <script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
    <script src="https://rawgit.com/fernandojsg/aframe-teleport-controls/master/dist/aframe-teleport-controls.min.js"></script>
    <script src="https://rawgit.com/Utopiah/googlepoly-load-component/master/googlepoly-load-component.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.1.0/dist/aframe-environment-component.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@4.0.1/dist/aframe-event-set-component.min.js"></script>
    <script src="https://unpkg.com/aframe-animation-component@^4.1.2/dist/aframe-animation-component.min.js"></script>

    <script>
      AFRAME.registerComponent("basic", {
        init: function() {
          var sceneEl = document.querySelector("a-scene");

          var colors = Array(
            "#d0dfe6",
            "#eef7f2",
            "#fcd337",
            "#f8df72",
            "#ffd111",
            "#fe8844",
            "#c88af9"
          );
          for (var i = 0; i < 30; i++) {
            var boxEl = document.createElement("a-sphere");
            var boxE2 = document.createElement("a-sphere");
            var boxE3 = document.createElement("a-sphere");
            boxEl.setAttribute("material", {
              color: colors[Math.floor(Math.random() * colors.length)]
            });
            boxE2.setAttribute("material", {
              color: colors[Math.floor(Math.random() * colors.length)]
            });
            boxE3.setAttribute("material", {
              color: colors[Math.floor(Math.random() * colors.length)]
            });
            var r = Math.max(20, Math.random() * 60);
            var theta = Math.random() * 360;
            boxEl.setAttribute("position", {
              x: Math.sin(theta) * r,
              y: Math.random() * 50 - 25,
              z: Math.cos(theta) * r - 8
            });
            boxE2.setAttribute("position", {
              x: Math.random() * 50 - 25,
              y: Math.cos(theta) * r - 8,
              z: Math.sin(theta) * r
            });
            boxE3.setAttribute("position", {
              x: Math.cos(theta) * r - 8,
              y: Math.sin(theta) * r,
              z: Math.random() * 50 - 25
            });
            boxEl.setAttribute("scale", { x: 0.1, y: 0.1, z: 0.1 });
            boxE2.setAttribute("scale", { x: 0.1, y: 0.1, z: 0.1 });
            boxE3.setAttribute("scale", { x: 0.1, y: 0.1, z: 0.1 });
            var dur = ((i % 5) + 1) * 2000;
            var value =
              "property: material.color; dur: " +
              dur +
              "; to: #0f1423; loop: true; easing: linear";
            boxEl.setAttribute("animation", value);
            boxE2.setAttribute("animation", value);
            boxE3.setAttribute("animation", value);
            sceneEl.appendChild(boxEl);
            sceneEl.appendChild(boxE2);
            sceneEl.appendChild(boxE3);
          }
        }
      });
    </script>
    <script>
      AFRAME.registerComponent("cursor-listener", {
        init: function() {
          var lastIndex = -1;
          var COLORS = ["#ffff80", "#ccffcc", "#99bbff", "#ccc0ff"];
          this.el.addEventListener("click", function(evt) {
            lastIndex = (lastIndex + 1) % COLORS.length;
            this.setAttribute("material", "color", COLORS[lastIndex]);
            console.log("I was clicked at: ", evt.detail.intersection.point);
          });
        }
      });
    </script>
  </head>
  <body>
    <a-scene basic cursor="rayOrigin: mouse" background="black">
      <a-assets>
        <!-- define common attributes for clickable objects -->
        <a-mixin
          id="collider"
          material="opacity: 0.99"
          event-set__mousedown="scale: 0.9 0.9 0.9"
          event-set__mouseenter="opacity: 0.8"
          event-set__mouseleave="opacity: 0.99"
          event-set__mouseup="scale: 1 1 1"
        ></a-mixin>

        <!-- define common attributes for hand controls -->
        <a-mixin
          id="hand"
          raycaster="objects: .clickable"
          teleport-controls="cameraRig: #cameraRig; teleportOrigin: #head; button: trigger"
        ></a-mixin>

        <a-mixin id="r-hand" raycaster="objects: .clickable"></a-mixin>
      </a-assets>

      <!--       Text label -->
      <a-text value="Lingyun Guo" position="0 5 -8"></a-text>

      <!-- prince -->
      <a-entity
        class="clickable"
        id="prince"
        position="0.89 3.049 -7.464"
        scale="0.03 0.03 0.03"
        rotation="9.673 73.523 2.59"
        gpoly="polyid: f_HG8bAlAfw; API_KEY: AIzaSyDsovdrekNH2A-NiKfMtMWA8LXebZQ41nk;"
        event-set__enter="_event: mouseenter; rotation: 11.673 130.35 4.59"
        event-set__leave="_event: mouseleave; rotation: 9.673 73.523 2.59"
      ></a-entity>

      <!-- star -->
      <a-sphere
        cursor-listener
        class="clickable"
        position="0 -2 -8"
        radius="3"
        color="#99bbff"
        shader="flat"
        opacity="0.4"
      ></a-sphere>
      <a-sphere position="0 -2 -8" radius="3" color="#bbd1e0"></a-sphere>

      <!-- rose -->
      <!--       source : https://poly.google.com/view/f6cqKzn4kPj -->
      <a-assets>
        <a-asset-item
          id="gltf"
          src="https://cdn.glitch.com/fcca0732-1a5f-40a8-a167-e58910fd68b9%2Fout.glb"
        ></a-asset-item>
      </a-assets>
      <a-entity
        id="rose"
        position="-1.096 0.483 -8"
        scale="1.2 1.2 1.2"
        rotation="-18.4 114.69 1.298"
        gltf-model="#gltf"
      ></a-entity>
      <a-cylinder
        class="clickable"
        id="glass"
        position="-1.261 1.042 -8"
        scale="0.3 0.9 0.3"
        rotation="2.292 2.42 24.95"
        color="#c6e6e8"
        opacity="0.4"
        event-set__enter="_event: mouseenter; _target: #rose; scale: 3 3 3; position: -1 0 -8; rotation: 15 37 0.36;"
        event-set__enterg="_event: mouseenter; _target: #glass; visible: false; "
        event-set__leave="_event: mouseleave; _target: #rose; scale: 1.2 1.2 1.2; position: -1.096 0.483 -8; rotation: -18.4 114.69 1.298;"
        event-set__leaveg="_event: mouseleave; _target: #glass; visible: true; "
      >
      </a-cylinder>

      <!-- sound -->
      <a-entity
        id="bgm"
        geometry="primitive: plane"
        material="color: #0f1423"
        position="-10 0 0"
        sound="src: https://cdn.glitch.com/fcca0732-1a5f-40a8-a167-e58910fd68b9%2Fviolet_evengarden_piano_cut.m4a?v=1579754323959; autoplay: true; loop: true"
      ></a-entity>

      <a-sky color="#0f1423"></a-sky>

      <!--       way points -->
      <a-plane
        class="waypoint clickable"
        color="#fad1f1"
        position="8 0 -8"
        rotation="-90 0 0"
      ></a-plane>
      <a-plane
        class="waypoint clickable"
        color="#0ef7f2"
        position="-4 0 -4"
        rotation="-90 0 0"
      ></a-plane>
      <a-plane
        class="waypoint clickable"
        color="#ff8080"
        position="-8 0 -8"
        rotation="-90 0 0"
      ></a-plane>
      <a-plane
        class="waypoint clickable"
        color="#ff99e6"
        position="4 0 -4"
        rotation="-90 0 0"
      ></a-plane>
      <a-plane
        class="waypoint clickable"
        color="#fcd337"
        position="0 0 0"
        rotation="-90 0 0"
      ></a-plane>
      <a-plane
        class="waypoint clickable"
        color="#b3b3ff"
        position="4 0 -12"
        rotation="-90 0 0"
      ></a-plane>
      <a-plane
        class="waypoint clickable"
        color="#ff9900"
        position="-4 0 -12"
        rotation="-90 0 0"
      ></a-plane>
      <a-plane
        class="waypoint clickable"
        color="#ccff99"
        position="0 0 -16"
        rotation="-90 0 0"
      ></a-plane>

      <!-- camera & hand controls -->

      <a-entity id="cameraRig">
        <a-entity
          id="head"
          camera
          position="0 1.6 0"
          wasd-controls
          look-controls
        ></a-entity>
        <a-entity
          id="lhand"
          mixin="hand"
          laser-controls="hand: left"
        ></a-entity>
        <a-entity
          id="rhand"
          mixin="r-hand"
          laser-controls="hand: right"
        ></a-entity>
      </a-entity>
    </a-scene>
  </body>
</html>
